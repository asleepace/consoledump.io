---
import '@/styles/global.css'
import { AppNavigationBar } from '@/components/react/AppNavigationBar'
import type { MarkdownHeading } from 'astro'
import type { CollectionEntry } from 'astro:content'
import TableOfContents from '@/components/astro/table-of-contents.astro'

type Props = CollectionEntry<'docs'>['data'] & {
  class?: string
  headings?: MarkdownHeading[]
}

const className = Astro.props.class
const headings = (Astro.props as Props).headings ?? []

import SiteHead from '@/components/astro/site-head.astro'
import SiteFooter from '@/components/astro/site-footer.astro'
import { cn } from '@/lib/utils'
---

<!doctype html>
<html lang="en">
  <head>
    <SiteHead />
  </head>
  <body
    class:list={[
      'flex flex-col w-full min-h-screen bg-black font-mono',
      className,
    ]}
  >
    <AppNavigationBar
      class:list={['sticky z-100 w-full top-0 left-0 right-0']}
      onOpenInfoPanel={() => {}}
      onOpenSettings={() => {}}
      onSubmitAction={(ev) => {
        // TODO: Handle search case here...
      }}
      downloadLogs={() => {}}
      clearLogs={() => {}}
      scrollToBottom={() => {}}
      isDocsMode
    />
    <div class="w-full px-4 md:px-6 py-8 pb-16 relative">
      <div
        class="mx-auto w-full max-w-[84rem] flex items-start justify-center gap-6"
      >
        <div class="hidden xl:block w-64 shrink-0" aria-hidden="true"></div>
        <article class="w-full min-w-0 flex-shrink">
          <slot />
        </article>
        <TableOfContents
          headings={headings}
          className={cn(!headings.length && 'hidden')}
        />
      </div>
    </div>
    <SiteFooter />
  </body>
</html>

<style is:global>
  @import 'tailwindcss';
  @import 'tw-animate-css';

  html {
    @apply antialiased;
    text-rendering: optimizeLegibility;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }

  html,
  body {
    @apply text-neutral-100;
    max-width: 100vw;
  }

  /* Article container */
  article {
    @apply w-full max-w-3xl mx-auto flex flex-col gap-y-6;
    overflow-x: hidden;
  }

  /* Ensure all article children respect width */
  article > * {
    max-width: 100%;
  }

  /* Code block styling - prevent overflow */
  pre {
    max-width: 100% !important;
    overflow-x: auto !important;
    -webkit-overflow-scrolling: touch;
    white-space: pre !important;
    word-wrap: normal !important;
    word-break: normal !important;
  }

  pre > code {
    display: inline-block;
    white-space: pre !important;
    word-wrap: normal !important;
    word-break: normal !important;
  }

  /* Force all code elements to respect wrapping rules */
  pre code,
  pre code span {
    white-space: pre !important;
  }

  /* Inline code */
  :not(pre) > code {
    @apply bg-white/5 text-orange-300 px-1.5 py-0.5 rounded text-sm border border-white/10;
    word-break: break-all;
    overflow-wrap: break-word;
    font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Roboto Mono', monospace;
  }

  /* Typography */
  article {
    line-height: 1.75;
    text-wrap: pretty;
  }

  article ul {
    @apply list-disc ms-6 space-y-2 my-6;
  }

  article ol {
    @apply list-decimal ms-6 space-y-2 my-6;
  }

  article li {
    @apply text-neutral-300 leading-relaxed;
  }

  article li::marker {
    @apply text-neutral-500;
  }

  /* Nested list refinements */
  article ul ul,
  article ol ul,
  article ul ol,
  article ol ol {
    @apply ms-6 mt-3 mb-0;
  }

  article li > p {
    @apply my-1;
  }

  article li > p + ul,
  article li > p + ol {
    @apply mt-3;
  }

  article a {
    @apply text-orange-400 underline decoration-orange-400/30 underline-offset-4 hover:decoration-orange-400 hover:text-orange-300;
    word-break: break-word;
    transition: all 0.2s ease;
  }

  article p {
    @apply text-neutral-300 my-6 leading-relaxed;
    font-size: 1.0625rem;
    text-wrap: pretty;
  }

  article p + p {
    @apply mt-4;
  }

  @media (max-width: 480px) {
    article p {
      font-size: 1rem;
      line-height: 1.7;
    }
  }

  article h1,
  article h2,
  article h3,
  article h4,
  article h5,
  article h6 {
    @apply text-white font-bold tracking-tight;
    scroll-margin-top: 96px;
    text-wrap: balance;
  }

  article h1 {
    @apply text-4xl sm:text-5xl lg:text-6xl font-black mt-2 mb-8 pb-4 border-b border-white/10;
    letter-spacing: -0.025em;
  }

  article h2 {
    @apply text-3xl sm:text-4xl lg:text-4xl font-bold mt-16 mb-6 pt-4;
    letter-spacing: -0.02em;
  }

  article h2::before {
    content: '';
    display: block;
    width: 3rem;
    height: 3px;
    background: linear-gradient(90deg, oklch(0.769 0.188 70.08), transparent);
    margin-bottom: 1.5rem;
    border-radius: 2px;
  }

  article h3 {
    @apply text-2xl sm:text-2xl lg:text-3xl font-semibold mt-12 mb-4 text-neutral-100;
    letter-spacing: -0.015em;
  }

  article h4 {
    @apply text-xl sm:text-xl lg:text-2xl font-semibold mt-8 mb-3 text-orange-400;
  }

  article h5 {
    @apply text-lg font-semibold mt-6 mb-2 text-neutral-200;
  }

  article h6 {
    @apply text-base font-semibold mt-4 mb-2 text-neutral-300;
  }

  /* Blockquotes */
  article blockquote {
    @apply border-l-4 border-orange-400/50 pl-6 pr-4 py-4 my-8 bg-white/5 rounded-r-lg;
  }

  article blockquote p {
    @apply text-neutral-300 italic my-2;
  }

  article blockquote p:first-child {
    @apply mt-0;
  }

  article blockquote p:last-child {
    @apply mb-0;
  }

  /* Horizontal rule */
  article hr {
    @apply border-0 h-px bg-gradient-to-r from-transparent via-white/20 to-transparent my-12;
  }

  /* Strong and emphasis */
  article strong {
    @apply text-white font-semibold;
  }

  article em {
    @apply text-neutral-200 italic;
  }

  /* Tables & media */
  article table {
    @apply w-full my-8 rounded-lg overflow-hidden;
    border-collapse: separate;
    border-spacing: 0;
    display: block;
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
  }

  article thead {
    @apply bg-white/10;
  }

  article th {
    @apply border border-white/10 px-4 py-3 text-left font-semibold text-white bg-white/5;
  }

  article td {
    @apply border border-white/10 px-4 py-3 align-top text-neutral-300;
  }

  article tbody tr {
    @apply hover:bg-white/5 transition-colors;
  }

  article img,
  article video,
  article svg,
  article canvas {
    @apply rounded-lg my-8 shadow-2xl;
    max-width: 100%;
    height: auto;
  }

  /* Section dividers */
  article > section {
    @apply my-12;
  }

  /* Table of Contents */
  .toc {
    font-size: 0.875rem;
    line-height: 1.4;
  }

  .toc ol {
    @apply m-0 p-0 list-none;
  }

  .toc li {
    @apply my-1;
  }

  .toc li.depth-3 {
    @apply ms-4;
    opacity: 0.9;
  }

  .toc a {
    @apply hover:underline no-underline;
    display: block;
    padding: 2px 0;
    word-break: break-word;
    transition: all 0.2s ease;
  }
</style>
