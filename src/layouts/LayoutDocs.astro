---
import '@/styles/global.css'
import { AppNavigationBar } from '@/components/react/AppNavigationBar'
import type { MarkdownHeading } from 'astro'
import type { CollectionEntry } from 'astro:content'
import TableOfContents from '@/components/astro/table-of-contents.astro'

type Props = CollectionEntry<'docs'>['data'] & {
  class?: string
  headings?: MarkdownHeading[]
}

const className = Astro.props.class
const headings = (Astro.props as Props).headings ?? []

import SiteHead from '@/components/astro/SiteHead.astro'
import SiteFooter from '@/components/astro/site-footer.astro'
import { cn } from '@/lib/utils'
---

<!doctype html>
<html lang="en">
  <head>
    <SiteHead />
  </head>
  <body
    class:list={[
      'flex flex-col w-full min-h-screen bg-black font-mono',
      className,
    ]}
  >
    <AppNavigationBar
      class:list={['sticky z-100 w-full top-0 left-0 right-0']}
      onOpenInfoPanel={() => {}}
      onOpenSettings={() => {}}
      onSubmitAction={(ev) => {
        // TODO: Handle search case here...
      }}
      downloadLogs={() => {}}
      clearLogs={() => {}}
      scrollToBottom={() => {}}
      isDocsMode
    />
    <div class="w-full px-4 md:px-6 py-8 pb-16 relative">
      <div
        class="mx-auto w-full max-w-[84rem] flex items-start justify-center gap-6"
      >
        <div class="hidden xl:block w-64 shrink-0" aria-hidden="true"></div>
        <article class="w-full min-w-0 flex-shrink">
          <slot />
        </article>
        <TableOfContents
          headings={headings}
          className={cn(!headings.length && 'hidden')}
        />
      </div>
    </div>
    <SiteFooter />
  </body>
</html>

<style is:global>
  @import 'tailwindcss';
  @import 'tw-animate-css';

  html,
  body {
    @apply text-neutral-100;
    max-width: 100vw;
  }

  /* Article container */
  article {
    @apply w-full max-w-3xl mx-auto flex flex-col gap-y-4;
    overflow-x: hidden;
  }

  /* Ensure all article children respect width */
  article > * {
    max-width: 100%;
  }

  /* Code block styling - prevent overflow */
  pre {
    max-width: 100% !important;
    overflow-x: auto !important;
    -webkit-overflow-scrolling: touch;
    white-space: pre !important;
    word-wrap: normal !important;
    word-break: normal !important;
  }

  pre > code {
    display: inline-block;
    white-space: pre !important;
    word-wrap: normal !important;
    word-break: normal !important;
  }

  /* Force all code elements to respect wrapping rules */
  pre code,
  pre code span {
    white-space: pre !important;
  }

  /* Inline code */
  :not(pre) > code {
    word-break: break-all;
    overflow-wrap: break-word;
  }

  /* Typography */
  article {
    line-height: 1.7;
  }

  article ul {
    @apply list-disc ms-5 md:ms-6;
  }

  article ol {
    @apply list-decimal ms-5 md:ms-6;
  }

  article li {
    @apply mt-1.5;
  }

  /* Nested list refinements */
  article ul ul,
  article ol ul,
  article ul ol,
  article ol ol {
    @apply ms-4 mt-1;
  }

  article li > p + ul,
  article li > p + ol {
    @apply mt-2;
  }

  article a {
    @apply text-orange-400 underline underline-offset-2 hover:text-orange-300;
    word-break: break-word;
  }

  article p {
    @apply text-neutral-200 mt-4 mb-2;
    font-size: 1.05rem;
  }

  @media (max-width: 480px) {
    article p {
      font-size: 1rem;
    }
  }

  article h1,
  article h2,
  article h3,
  article h4,
  article h5,
  article h6 {
    scroll-margin-top: 84px; /* clear sticky navbar on anchor jumps */
  }

  article h1 {
    @apply text-3xl lg:text-5xl font-black pt-6;
  }

  article h2 {
    @apply text-2xl lg:text-3xl font-bold mt-8;
  }

  article h3 {
    @apply text-xl lg:text-2xl font-bold mt-6;
  }

  article h4 {
    @apply text-lg lg:text-xl text-orange-400 font-bold mt-4;
  }

  /* Tables & media */
  article table {
    width: 100%;
    border-collapse: collapse;
    display: block;
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
  }

  article th,
  article td {
    @apply border border-white/10 px-3 py-2 align-top;
  }

  article img,
  article video,
  article svg,
  article canvas {
    max-width: 100%;
    height: auto;
  }

  /* Table of Contents */
  .toc {
    font-size: 0.875rem;
    line-height: 1.4;
  }

  .toc ol {
    @apply m-0 p-0 list-none;
  }

  .toc li {
    @apply my-1;
  }

  .toc li.depth-3 {
    @apply ms-4;
    opacity: 0.9;
  }

  .toc a {
    @apply hover:underline no-underline;
    display: block;
    padding: 2px 0;
    word-break: break-word;
    transition: all 0.2s ease;
  }
</style>
