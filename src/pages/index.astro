---
import Layout from '@/layouts/Layout.astro'
import { sessions } from '@/lib/server'

export const prerender = false

const stream = await sessions.createSession(crypto.randomUUID().slice(0, 6))

if (!stream.id) throw new Error('Invalid stream id')

Astro.rewrite(`/${stream.id}`)
---

<Layout />
<script define:vars={{ path: stream.id }}>
  window.location.pathname += path
</script>
